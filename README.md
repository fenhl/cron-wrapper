This project is a small set of tools to help deal with errors in cronjobs without relying on email. You can build them with <code>[cargo](https://doc.rust-lang.org/cargo/) build --release --workspace</code>, then find them in `target/release`.

# cronjob-wrapper

This utility runs a specified crontab, reporting errors by saving them to a file. For example, here's a crontab from one of my servers:

```crontab
PATH=/opt/night/bin:/usr/local/share/fidera/bin:/opt/git/github.com/fenhl/syncbin/master/bin:/usr/bin:/home/fenhl/.cargo/bin

55 *  *     * * cronjob-wrapper                      night-ci      -- night-ci
33 *  *     * * cronjob-wrapper --no-diskspace-check nightd-backup -- nightd-backup
2  *  *     * * cronjob-wrapper                      pre-event     -- pre-event
17 23 28-31 * * cronjob-wrapper                      resize-gharch -- zsh -c '[[ "$(date --date=tomorrow +\%d)" == "01" ]] && /opt/wurstmineberg/bin/resize-linode'
57 9  *     * * cronjob-wrapper --no-diskspace-check rust          -- rust --quiet --all-projects --release
16 *  *     * * cronjob-wrapper                      update-night  -- zsh -c 'cd /opt/git/localhost/rust-night/master && cargo update --quiet --aggressive && cargo build --quiet --release && cargo sweep --installed > /dev/null'
```

If a cronjob fails, an error report is saved in `/home/fenhl/.local/share/syncbin` on Linux or `/Users/fenhl/Desktop` on macOS. (You may want to adjust these paths in [crate/cron-wrapper/src/lib.rs](https://github.com/fenhl/cron-wrapper/blob/main/crate/cron-wrapper/src/lib.rs) if you're using this script.) If a cronjob succeeds, its error report is deleted.

# bitbar-cron

This is a BitBar plugin (supporting both [SwiftBar](https://swiftbar.app/) and [xbar](https://xbarapp.com/)) that, for the local host as well as a set of hosts specified in `bitbar/plugins/cron.json` in an [XDG config directory](https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html), checks for the error reports generated by `cronjob-wrapper` to list all cronjobs whose most recent run failed. It disappears completely if there are no failing cronjobs.
